---
phase: 04-company-industry-view
plan: 03
type: execute
wave: 3
depends_on: [04-02]
files_modified:
  - src/components/ftc/industry/SectorCompare.tsx
  - src/components/ftc/FTCIndustryTab.tsx
autonomous: true
requirements: [INDY-02]

must_haves:
  truths:
    - "User can select 2-3 sectors from the grid using checkboxes, then click 'Compare Selected' to open a side-by-side view"
    - "Compare view shows each selected sector in its own column with topic and remedy distribution charts"
    - "Compare view displays a note about cases appearing in multiple sectors"
    - "User can navigate back from compare view to the sector grid"
    - "Compare state is persisted in the URL via ?compare=technology,healthcare"
  artifacts:
    - path: "src/components/ftc/industry/SectorCompare.tsx"
      provides: "Side-by-side sector comparison with charts and summary stats"
      exports: ["default"]
  key_links:
    - from: "src/components/ftc/FTCIndustryTab.tsx"
      to: "src/components/ftc/industry/SectorCompare.tsx"
      via: "conditional render when compare URL param is present"
      pattern: "compareSectors.*SectorCompare"
    - from: "src/components/ftc/industry/SectorCompare.tsx"
      to: "src/components/ftc/industry/SectorPatternCharts.tsx"
      via: "reused chart component per sector column"
      pattern: "SectorPatternCharts"
---

<objective>
Build the sector comparison view that shows enforcement pattern charts side-by-side for 2-3 selected sectors, and wire the comparison flow from the sector grid through to the URL-driven compare view.

Purpose: Enables practitioners to compare how enforcement patterns differ across sectors — the core differentiating insight of the industry view. Answering questions like "How does Technology enforcement differ from Healthcare enforcement?" at a glance.

Output: SectorCompare component with responsive multi-column layout reusing SectorPatternCharts, wired into FTCIndustryTab URL routing.
</objective>

<execution_context>
@C:/Users/rafst/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rafst/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-company-industry-view/04-RESEARCH.md
@.planning/phases/04-company-industry-view/04-01-SUMMARY.md
@.planning/phases/04-company-industry-view/04-02-SUMMARY.md
@src/components/ftc/industry/SectorPatternCharts.tsx
@src/components/ftc/industry/industry-utils.ts
@src/components/ftc/FTCIndustryTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SectorCompare with side-by-side enforcement pattern charts</name>
  <files>
    src/components/ftc/industry/SectorCompare.tsx
  </files>
  <action>
Create SectorCompare.tsx:
1. Accept Props: `{ sectorSlugs: string[], sectorStats: Record<string, { cases: EnhancedFTCCaseSummary[] }>, onBack: () => void }`
2. Resolve sector definitions from slugs using getSectorBySlug from industry-utils
3. Filter out any invalid slugs (getSectorBySlug returns undefined)
4. If fewer than 2 valid sectors, show a message "Select at least 2 sectors to compare" with a back button

Layout:
5. Header section:
   - Back arrow + Breadcrumb: "Industries" (clickable) > "Compare" (BreadcrumbPage) — same Breadcrumb pattern as SectorDetail
   - h2: "Sector Comparison" with font-garamond text-2xl
   - Info note: "Some cases appear in multiple sectors and are counted in each." — text-sm text-muted-foreground
   - List of compared sector names as Badges
6. Responsive multi-column grid:
   - `grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6`
   - Max 3 columns (max 3 sectors can be compared per user decision)
7. Each column contains:
   - Sector header: h3 with sector label + Badge showing case count
   - SectorPatternCharts component (reused from Plan 02) with that sector's cases
   - Top 5 companies list: compute top 5 companies by num_provisions descending, render as an ordered list with company_name and provision count
8. Styling:
   - Each column wrapped in `border border-rule p-4 bg-cream/20`
   - Column headings use `font-garamond text-lg font-semibold text-primary`
   - Top companies list: `space-y-1 text-sm font-garamond`
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors. Run `npx vite build` — no build failures.
  </verify>
  <done>SectorCompare renders a responsive multi-column layout. Each column shows a sector's enforcement pattern charts (topic and remedy distribution) and top companies. Layout adapts from 1 column on mobile to 2-3 columns on desktop.</done>
</task>

<task type="auto">
  <name>Task 2: Wire compare flow in FTCIndustryTab and SectorGrid</name>
  <files>
    src/components/ftc/FTCIndustryTab.tsx
  </files>
  <action>
Update FTCIndustryTab.tsx:
1. Replace the placeholder "Compare: {compare}" with `<SectorCompare>` component
2. Import SectorCompare
3. Parse compare param: `const compareSectors = compareParam ? compareParam.split(",").filter(Boolean) : []`
4. Pass to SectorCompare: sectorSlugs={compareSectors}, sectorStats, onBack callback
5. onBack for compare: same as sector detail — navigate to `?tab=industries` clearing compare param

Wire the compare flow from SectorGrid:
6. The SectorGrid (from Plan 01) already has selectedSectors Set and onToggleSelect for checkboxes
7. Ensure FTCIndustryTab's compare navigation logic is correct:
   - When "Compare Selected" is clicked in SectorGrid, FTCIndustryTab should navigate to `?tab=industries&compare=slug1,slug2,slug3`
   - Add a `onCompare` callback prop to SectorGrid that receives the selectedSectors set and constructs the compare URL
   - In FTCIndustryTab, define onCompare: `(sectors: Set<string>) => { const params = new URLSearchParams(); params.set("tab", "industries"); params.set("compare", Array.from(sectors).join(",")); setSearchParams(params, { replace: true }); }`
8. Limit selection to 3 sectors: in SectorGrid, when onToggleSelect is called, check if adding would exceed 3 — if so, do not add (or show a toast). The SectorGrid "Compare Selected" button should be disabled when fewer than 2 sectors are selected.
9. Clear selectedSectors state when navigating to detail view or when tab changes (the URL clearing handles this since the grid re-renders from scratch).
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors. Run `npx vite build` — no build failures. Test the full compare flow:
1. Navigate to Industries tab
2. Check 2 sector cards — checkboxes appear selected, sticky bar appears with "Compare Selected" button
3. Click "Compare Selected" — URL updates to `?tab=industries&compare=technology,healthcare`
4. Compare view shows 2 columns with enforcement pattern charts for each sector
5. Back arrow returns to grid
6. Try selecting 3 sectors — all three show in compare view with 3 columns
7. Try selecting more than 3 — fourth checkbox does not activate
  </verify>
  <done>Full compare flow works end-to-end: select 2-3 sectors via checkboxes on the grid, click Compare, see side-by-side charts and top companies, navigate back. URL state persists the compare selection.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vite build` succeeds
3. Sector grid checkboxes allow selecting 2-3 sectors (not more)
4. "Compare Selected" button appears when 2+ sectors are checked
5. Compare view shows side-by-side columns with matching chart styles
6. Each column shows topic chart, remedy chart, and top 5 companies
7. Multi-sector overlap note is displayed
8. Back navigation returns to grid
9. Compare URL is shareable: `?tab=industries&compare=technology,healthcare` loads the compare view directly
</verification>

<success_criteria>
The sector comparison view enables side-by-side analysis of enforcement patterns across 2-3 sectors. Users can visually compare which topics and remedy types dominate each sector, making the industry browsing feature a practical tool for understanding sector-specific enforcement focus.
</success_criteria>

<output>
After completion, create `.planning/phases/04-company-industry-view/04-03-SUMMARY.md`
</output>
