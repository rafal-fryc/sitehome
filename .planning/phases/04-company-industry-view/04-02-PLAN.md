---
phase: 04-company-industry-view
plan: 02
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - src/components/ftc/industry/SectorDetail.tsx
  - src/components/ftc/industry/SectorPatternCharts.tsx
  - src/components/ftc/industry/CaseCard.tsx
  - src/components/ftc/industry/CaseCardList.tsx
  - src/components/ftc/FTCIndustryTab.tsx
autonomous: true
requirements: [INDY-01, INDY-02, INDY-03]

must_haves:
  truths:
    - "User can click a sector card and see a detail view with breadcrumb navigation showing 'Industries > Technology'"
    - "User sees horizontal bar charts showing statutory topic and remedy type distribution for the selected sector"
    - "User sees expandable reference tables below each chart with exact counts"
    - "User sees a paginated list of case cards (20 per page) within the selected sector"
    - "Each case card shows company name, year, violation type, and provision count"
    - "User can click 'View provisions' on a case card to navigate to the Provisions Library tab"
    - "User can sort case cards by date, company name, or provision count"
    - "User can filter case cards by enforcement topic within the sector"
    - "Back arrow returns to the sector grid"
  artifacts:
    - path: "src/components/ftc/industry/SectorDetail.tsx"
      provides: "Sector detail view with breadcrumb, charts, and case list"
      exports: ["default"]
    - path: "src/components/ftc/industry/SectorPatternCharts.tsx"
      provides: "Horizontal bar charts for topic and remedy type distribution with ReferenceTable"
      exports: ["default"]
    - path: "src/components/ftc/industry/CaseCard.tsx"
      provides: "Compact enforcement action card with provision link"
      exports: ["default"]
    - path: "src/components/ftc/industry/CaseCardList.tsx"
      provides: "Paginated, sortable, filterable case card list"
      exports: ["default"]
  key_links:
    - from: "src/components/ftc/FTCIndustryTab.tsx"
      to: "src/components/ftc/industry/SectorDetail.tsx"
      via: "conditional render when sector URL param is present"
      pattern: "selectedSector.*SectorDetail"
    - from: "src/components/ftc/industry/SectorDetail.tsx"
      to: "src/components/ftc/industry/SectorPatternCharts.tsx"
      via: "direct child component"
      pattern: "SectorPatternCharts"
    - from: "src/components/ftc/industry/SectorDetail.tsx"
      to: "src/components/ftc/industry/CaseCardList.tsx"
      via: "direct child component"
      pattern: "CaseCardList"
    - from: "src/components/ftc/industry/CaseCard.tsx"
      to: "Provisions Library tab"
      via: "setSearchParams navigation to ?tab=provisions"
      pattern: "tab.*provisions"
---

<objective>
Build the sector detail view with enforcement pattern charts, reference tables, and a paginated case card list with sort/filter controls and cross-tab navigation to the Provisions Library.

Purpose: This is the core analytical view for each industry sector. Users can understand enforcement patterns (which topics and remedies dominate a sector) and browse individual enforcement actions with links to full provisions.

Output: SectorDetail page with breadcrumb navigation, SectorPatternCharts with Recharts horizontal bars and ReferenceTable, CaseCard and CaseCardList with pagination/sort/filter.
</objective>

<execution_context>
@C:/Users/rafst/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rafst/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-company-industry-view/04-RESEARCH.md
@.planning/phases/04-company-industry-view/04-01-SUMMARY.md
@src/components/ftc/analytics/ProvisionAnalytics.tsx
@src/components/ftc/analytics/ReferenceTable.tsx
@src/components/ftc/industry/industry-utils.ts
@src/types/ftc.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SectorPatternCharts and CaseCard components</name>
  <files>
    src/components/ftc/industry/SectorPatternCharts.tsx
    src/components/ftc/industry/CaseCard.tsx
  </files>
  <action>
Create SectorPatternCharts.tsx:
1. Accept Props: `{ cases: EnhancedFTCCaseSummary[], sectorLabel: string }`
2. Use useMemo to compute two datasets from cases:
   a. topicData: count of statutory_topics across all cases, sorted descending by count, mapped to `{ name: string, count: number }[]`
   b. remedyData: count of remedy_types across all cases, sorted descending by count, mapped to `{ name: string, count: number }[]`
3. Render two chart sections, each with:
   - Section heading (h4 with font-garamond, e.g., "Enforcement Topics in Technology" and "Remedy Types in Technology")
   - Horizontal bar chart using the EXACT Recharts pattern from ProvisionAnalytics.tsx:
     - `<BarChart data={data} layout="vertical">` with `<CartesianGrid strokeDasharray="3 3" stroke="hsl(50, 15%, 85%)" />`
     - `<XAxis type="number" tick={{ fontSize: 12, fill: "hsl(158, 20%, 35%)" }} />`
     - `<YAxis type="category" dataKey="name" width={200} tick={{ fontSize: 12, fill: "hsl(158, 20%, 35%)" }} />`
     - `<Tooltip contentStyle={{ background: "hsl(40, 50%, 98%)", border: "1px solid hsl(40, 25%, 80%)", borderRadius: 0, fontFamily: "EB Garamond, serif" }} />`
     - `<Bar dataKey="count">` with alternating Cell fills: even=`hsl(158, 60%, 35%)` odd=`hsl(45, 85%, 55%)`
     - Dynamic chart height: `Math.max(250, data.length * 40)`
   - ReferenceTable below each chart (import from @/components/ftc/analytics/ReferenceTable)
     - Topic table: headers ["Topic", "Cases"], rows from topicData
     - Remedy table: headers ["Remedy Type", "Cases"], rows from remedyData
4. Wrap both sections in a div with className="space-y-8"

Create CaseCard.tsx:
1. Accept Props: `{ caseData: EnhancedFTCCaseSummary, onViewProvisions: () => void }`
2. Compact horizontal card layout using article element with border styling: `border border-rule bg-cream/30 px-4 py-3 flex items-center gap-4`
3. Left section (flex-1 min-w-0):
   - Company name: `font-semibold text-primary font-garamond truncate`
   - Year: `text-sm text-muted-foreground`
   - Violation type: `text-xs text-muted-foreground uppercase tracking-wide-label`
   - Provision count below: `text-xs text-muted-foreground mt-0.5` — "{N} provision{s}"
4. Right section (shrink-0):
   - "View provisions" button: `text-sm text-gold hover:text-gold/80 font-garamond inline-flex items-center gap-1`
   - ExternalLink icon from lucide-react (h-3.5 w-3.5)
   - onClick calls onViewProvisions
5. Use `export default function CaseCard` pattern
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors. Run `npx vite build` — no build failures. Components are importable and follow established Recharts and styling patterns.
  </verify>
  <done>SectorPatternCharts renders horizontal bar charts for topic and remedy distribution with ReferenceTable drill-down. CaseCard renders a compact enforcement action card with company, year, violation type, provision count, and "View provisions" link.</done>
</task>

<task type="auto">
  <name>Task 2: Create CaseCardList, SectorDetail, and wire into FTCIndustryTab</name>
  <files>
    src/components/ftc/industry/CaseCardList.tsx
    src/components/ftc/industry/SectorDetail.tsx
    src/components/ftc/FTCIndustryTab.tsx
  </files>
  <action>
Create CaseCardList.tsx:
1. Accept Props: `{ cases: EnhancedFTCCaseSummary[], onViewProvisions: (caseData: EnhancedFTCCaseSummary) => void }`
2. Implement sort state: sortKey ("date" | "company" | "provisions"), sortDir ("asc" | "desc"), default date descending
3. Implement topic filter state: selectedTopic (string | null) using a Popover + Checkbox multi-select pattern (same as remedy type filter in ProvisionFilterBar) — list all unique statutory_topics from the cases
4. Sort logic in useMemo:
   - date: compare by date_issued
   - company: localeCompare on company_name
   - provisions: compare by num_provisions
5. Filter logic in useMemo (applied before sort): if selectedTopic is set, filter cases to only those with selectedTopic in their statutory_topics
6. Pagination: 20 per page per user decision. Use the same pagination pattern as ProvisionsContent.tsx — getPageNumbers helper with ellipsis-based page numbers, Pagination components from shadcn/ui
7. Render:
   - Filter/sort controls bar: sort dropdown (Select or button group for date/company/provisions with direction toggle) + topic filter Popover + result count "N cases"
   - List of CaseCard components for current page
   - Pagination controls at bottom
8. Page resets to 1 on sort/filter change (useEffect pattern from ProvisionsContent)

Create SectorDetail.tsx:
1. Accept Props: `{ sectorSlug: string, cases: EnhancedFTCCaseSummary[], onBack: () => void }`
2. Look up sector by slug using getSectorBySlug from industry-utils
3. If sector not found, show "Sector not found" message
4. Render layout:
   a. Breadcrumb navigation at top using shadcn/ui Breadcrumb components:
      - Back arrow button (ArrowLeft from lucide-react) calling onBack
      - Breadcrumb: "Industries" (clickable, calls onBack) > "{Sector Label}" (BreadcrumbPage)
      - Same pattern from research code example
   b. Sector header: h2 with sector label + Badge showing "{N} enforcement actions"
   c. Note about multi-sector cases: small text "Some cases appear in multiple sectors and are counted in each."
   d. SectorPatternCharts component with the sector's cases
   e. Divider (border-t border-rule my-8)
   f. CaseCardList with the sector's cases
5. For onViewProvisions callback passed to CaseCardList: construct URL params `{ tab: "provisions" }` and use setSearchParams to navigate. This takes the user to the Provisions Library landing page. (Per research, a direct case filter is not available — the user sees the provisions library and can filter by company from there.)

Wire into FTCIndustryTab.tsx:
1. Replace the placeholder "Sector detail: {sector}" with `<SectorDetail>` component
2. Pass sectorSlug, cases (filtered from sectorStats for the selected sector), and onBack callback that clears the sector param
3. onBack handler: create new URLSearchParams, set tab=industries, clear sector param, call setSearchParams
4. onViewProvisions handler: create new URLSearchParams, set tab=provisions, call setSearchParams (navigates to provisions landing)
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors. Run `npx vite build` — no build failures. Navigate to Industries tab, click a sector card, confirm:
1. Breadcrumb shows "Industries > {Sector Name}" with back arrow
2. Horizontal bar charts display topic and remedy distribution
3. Reference tables expand below charts
4. Case cards show company, year, violation type, provision count
5. Pagination shows max 20 case cards per page
6. Sort controls work (date/company/provision count)
7. Topic filter narrows case list
8. "View provisions" link navigates to Provisions Library tab
9. Back arrow returns to the sector grid
  </verify>
  <done>Sector detail view is fully functional. Users can navigate to any sector, see enforcement pattern charts with reference tables, browse paginated case cards with sort and filter, and click through to the Provisions Library. Breadcrumb navigation allows returning to the grid.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vite build` succeeds
3. Clicking a sector card shows the detail view with breadcrumb navigation
4. Horizontal bar charts match the analytics tab visual style (same colors, fonts, grid stroke)
5. ReferenceTable expands with exact counts
6. Case cards display 20 per page with pagination
7. Sort by date (default descending), company name, or provision count works
8. Topic filter narrows the case list within the sector
9. "View provisions" link navigates to `?tab=provisions`
10. Back arrow returns to sector grid without stale state
</verification>

<success_criteria>
The sector detail view is the primary analytical page for each industry sector. Users see enforcement patterns via charts and tables, browse enforcement actions via paginated case cards with sort/filter, and can navigate to the Provisions Library for full provision details. All visual styling matches the established law-library aesthetic.
</success_criteria>

<output>
After completion, create `.planning/phases/04-company-industry-view/04-02-SUMMARY.md`
</output>
