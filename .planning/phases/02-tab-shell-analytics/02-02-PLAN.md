---
phase: 02-tab-shell-analytics
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - src/components/ftc/FTCSectionSidebar.tsx
  - src/components/ftc/analytics/AnalyticsSummary.tsx
  - src/components/ftc/analytics/ReferenceTable.tsx
autonomous: true
requirements: [ANLY-05, ANLY-06]

must_haves:
  truths:
    - "A sticky sidebar on desktop shows section names and highlights the active section as the user scrolls"
    - "On mobile/tablet, the sidebar collapses into a horizontal scrollable bar above the content"
    - "The Analytics tab opens with a headline and 1-2 sentence summary showing date range and total cases"
    - "Reference tables show rich breakdowns (year/topic, case count, top statutes, notable cases) below charts"
    - "Table rows are clickable and expand inline to show matching cases — no modals, no navigation"
    - "The sidebar feels like a table-of-contents in a reference book"
  artifacts:
    - path: "src/components/ftc/FTCSectionSidebar.tsx"
      provides: "Sticky sidebar with IntersectionObserver-based active section tracking"
      exports: ["default"]
    - path: "src/components/ftc/analytics/AnalyticsSummary.tsx"
      provides: "Headline + summary stats (date range, total cases, total provisions)"
      exports: ["default"]
    - path: "src/components/ftc/analytics/ReferenceTable.tsx"
      provides: "Reusable expandable table component for chart+table sections"
      exports: ["default"]
  key_links:
    - from: "src/components/ftc/FTCSectionSidebar.tsx"
      to: "IntersectionObserver"
      via: "useEffect observer setup"
      pattern: "IntersectionObserver"
    - from: "src/components/ftc/analytics/ReferenceTable.tsx"
      to: "src/components/ui/table.tsx"
      via: "shadcn Table components"
      pattern: "import.*Table.*from.*@/components/ui/table"
---

<objective>
Build the three shared infrastructure components that all analytics chart sections depend on: sticky section sidebar, analytics summary header, and reusable expandable reference table.

Purpose: These components are used by every chart section in Plans 03 and 04. Building them first avoids duplication and ensures consistent patterns across all analytics sections.

Output: FTCSectionSidebar.tsx, AnalyticsSummary.tsx, ReferenceTable.tsx — all styled with law-library aesthetic.
</objective>

<execution_context>
@C:/Users/rafst/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rafst/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-tab-shell-analytics/02-CONTEXT.md
@.planning/phases/02-tab-shell-analytics/02-RESEARCH.md
@.planning/phases/02-tab-shell-analytics/02-01-SUMMARY.md
@src/components/ui/table.tsx
@src/types/ftc.ts
@src/hooks/use-ftc-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FTCSectionSidebar with IntersectionObserver and responsive collapse</name>
  <files>
    src/components/ftc/FTCSectionSidebar.tsx
  </files>
  <action>
    Create FTCSectionSidebar.tsx with this behavior:

    Props interface:
    - sections: Array of { id: string; label: string }
    - className?: string (for layout integration)

    Desktop sidebar (visible at lg breakpoint and above):
    - Use `position: sticky` with `top: 6rem` (top-24) to stick below header
    - Fixed width: w-48, shrink-0, self-start
    - Render a `nav` with `ul` list, each item is a button
    - Left border line (border-l-2 border-rule) with active item highlighted using border-l-gold and text-primary font-semibold
    - Inactive items: border-l-transparent, text-muted-foreground, hover:text-foreground
    - Clicking a section button calls `document.getElementById(id)?.scrollIntoView({ behavior: "smooth" })`
    - Style like a book table-of-contents: text-sm, serif font (font-garamond), pl-4 padding

    Mobile/tablet bar (visible below lg breakpoint):
    - Use `lg:hidden` to show only on small screens
    - Sticky horizontal bar at top: `sticky top-0 z-10 bg-background border-b border-rule`
    - Horizontal scroll: `overflow-x-auto` with `flex gap-4 px-4 py-2 min-w-max`
    - Active section: text-primary font-semibold border-b-2 border-gold
    - Inactive: text-muted-foreground

    Active section tracking:
    - useEffect with IntersectionObserver watching all section elements by their id
    - rootMargin: "-20% 0px -70% 0px" (triggers when section is in top 30% of viewport)
    - When a section intersects, update activeSection state
    - Cleanup: observer.disconnect() on unmount
    - Re-observe when sections array changes (include sections in useEffect deps, use stable references)

    Use `export default function FTCSectionSidebar` pattern per project conventions.
  </action>
  <verify>
    Run `npx tsc --noEmit` — zero TypeScript errors.
    Component exports default function. IntersectionObserver setup is correct with cleanup.
  </verify>
  <done>
    FTCSectionSidebar.tsx renders a sticky desktop sidebar and responsive mobile bar. Active section updates via IntersectionObserver as user scrolls. Styling matches law-library aesthetic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AnalyticsSummary and ReferenceTable components</name>
  <files>
    src/components/ftc/analytics/AnalyticsSummary.tsx
    src/components/ftc/analytics/ReferenceTable.tsx
  </files>
  <action>
    Create analytics/ subdirectory under src/components/ftc/.

    Create AnalyticsSummary.tsx:
    - Props: { data: FTCDataPayload }
    - Compute from data: total cases, date range (min year to max year), total provisions (sum of num_provisions across all cases)
    - Render a heading: "FTC Enforcement Analytics" in text-2xl font-bold text-primary
    - Below heading: 1-2 sentence summary in text-muted-foreground, e.g., "Analyzing {totalCases} enforcement actions from {minYear} to {maxYear}, encompassing {totalProvisions} consent order provisions across {numTopics} statutory topics."
    - Use EB Garamond font (already the default via font-garamond)
    - Keep it compact — this is a brief orientation, not a dashboard

    Create ReferenceTable.tsx:
    - This is a reusable table component with expandable rows per CONTEXT.md decisions.

    Props interface:
    ```typescript
    interface ReferenceRow {
      key: string;
      cells: React.ReactNode[];
      expandedContent?: React.ReactNode; // If present, row is expandable
    }
    interface Props {
      headers: string[];
      rows: ReferenceRow[];
      caption?: string; // Optional table caption
    }
    ```

    Implementation:
    - Import Table, TableBody, TableCell, TableHead, TableHeader, TableRow from @/components/ui/table
    - Import ChevronDown, ChevronRight from lucide-react
    - Local state: expandedRows as Set<string>
    - toggleRow function: toggle key in/out of the Set (create new Set to trigger re-render)
    - Render table with headers row (bg-muted/30 for subtle header background)
    - First column is a narrow expand icon column (w-8) — shows ChevronDown when expanded, ChevronRight when collapsed, empty if row has no expandedContent
    - Row has cursor-pointer and hover:bg-accent/20 if expandable
    - When expanded: render an additional TableRow below with colSpan covering all columns, containing the expandedContent in a div with p-4 bg-cream/50 border-t border-rule
    - The expanded row feels inline and natural — not a modal or dialog

    Style with law-library aesthetic:
    - Table text uses serif font (inherited from global font-garamond)
    - Header cells: text-xs uppercase tracking-wide-label text-muted-foreground
    - Data cells: text-sm text-foreground
    - Borders: border-rule color
    - Use Fragment (<></>) wrapper for each row + expanded pair, with key on the Fragment

    Export as `export default function ReferenceTable`.
  </action>
  <verify>
    Run `npx tsc --noEmit` — zero TypeScript errors.
    Both components export default functions. ReferenceTable accepts headers + rows with expandable content.
  </verify>
  <done>
    AnalyticsSummary.tsx renders headline + summary sentence with date range and case counts. ReferenceTable.tsx renders tables with clickable expandable rows. Both use law-library aesthetic and are ready for use by chart section components in Plans 03 and 04.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. FTCSectionSidebar renders sticky sidebar on desktop, horizontal bar on mobile
3. AnalyticsSummary shows headline, date range, total cases
4. ReferenceTable renders expandable rows with chevron icons and inline expansion
5. All components use law-library aesthetic (serif font, cream/gold/green palette)
6. No regression in existing analytics tab functionality
</verification>

<success_criteria>
- Three shared infrastructure components exist and compile
- Components follow project conventions (export default function, @/ imports, Tailwind styling)
- ReferenceTable expandable rows work with click toggle
- FTCSectionSidebar tracks active section via IntersectionObserver
- Ready for chart sections (Plans 03, 04) to compose these components
</success_criteria>

<output>
After completion, create `.planning/phases/02-tab-shell-analytics/02-02-SUMMARY.md`
</output>
