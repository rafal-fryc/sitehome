---
phase: 03-provisions-library
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/hooks/use-provisions.ts
  - src/components/ftc/FTCProvisionsTab.tsx
  - src/components/ftc/provisions/TopicSidebar.tsx
  - src/components/ftc/provisions/ProvisionsLanding.tsx
  - src/components/ftc/provisions/ProvisionsContent.tsx
  - src/components/ftc/provisions/ProvisionCard.tsx
autonomous: true
requirements:
  - PROV-01
  - PROV-02
  - PROV-03
  - PROV-04
  - PROV-10

must_haves:
  truths:
    - "User can see a sidebar listing all topics grouped by Statutory Authority, Practice Area, and Remedy Type with provision count badges"
    - "User can select a topic from the sidebar and see provision cards for that topic"
    - "Each provision card shows a context header with company name, year, docket number, citation, violation type, and a View on FTC.gov link"
    - "Each provision card displays full verbatim order language below the header"
    - "Before selecting a topic, user sees a landing view with total provision/case counts"
    - "The selected topic is persisted in the URL via ?topic= search param"
  artifacts:
    - path: "src/hooks/use-provisions.ts"
      provides: "React Query hooks for manifest and provision shard fetching"
      exports: ["useProvisionsManifest", "useProvisionShard"]
    - path: "src/components/ftc/FTCProvisionsTab.tsx"
      provides: "Main provisions tab component with sidebar + content layout"
    - path: "src/components/ftc/provisions/TopicSidebar.tsx"
      provides: "Persistent topic sidebar grouped by category with count badges"
    - path: "src/components/ftc/provisions/ProvisionsLanding.tsx"
      provides: "Landing view with totals and prompt to select topic"
    - path: "src/components/ftc/provisions/ProvisionsContent.tsx"
      provides: "Provision list with disclaimer banner and paginated cards"
    - path: "src/components/ftc/provisions/ProvisionCard.tsx"
      provides: "Individual provision card with context header + verbatim text"
  key_links:
    - from: "src/hooks/use-provisions.ts"
      to: "public/data/provisions/manifest.json"
      via: "React Query fetch"
      pattern: "fetch.*manifest.json"
    - from: "src/hooks/use-provisions.ts"
      to: "public/data/provisions/*.json"
      via: "React Query fetch by shard filename"
      pattern: "fetch.*provisions/"
    - from: "src/components/ftc/FTCProvisionsTab.tsx"
      to: "src/hooks/use-provisions.ts"
      via: "imports useProvisionsManifest and useProvisionShard"
      pattern: "useProvisionsManifest|useProvisionShard"
    - from: "src/components/ftc/provisions/TopicSidebar.tsx"
      to: "src/hooks/use-provisions.ts"
      via: "receives manifest data as props from FTCProvisionsTab"
      pattern: "manifest"
---

<objective>
Build the core provisions browsing experience: data hooks, topic sidebar with grouped categories and count badges, landing view, provision card with context header and verbatim text, and paginated content area.

Purpose: This is the primary value proposition of the tool. Legal practitioners need to select a topic and immediately see relevant provisions with exact citations and verbatim order language. The sidebar provides topic discovery, the landing view orients the user, and the provision cards deliver the core content.

Output: Data fetching hooks, topic sidebar, landing view, provision content area with cards, paginated display
</objective>

<execution_context>
@C:/Users/rafst/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rafst/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-provisions-library/03-RESEARCH.md
@.planning/phases/03-provisions-library/03-01-SUMMARY.md
@src/types/ftc.ts
@src/components/ftc/FTCTabShell.tsx
@src/components/ftc/FTCSectionSidebar.tsx
@src/components/ftc/FTCAnalyticsTab.tsx
@src/hooks/use-ftc-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create data hooks and topic sidebar with landing view</name>
  <files>
    src/hooks/use-provisions.ts
    src/components/ftc/provisions/TopicSidebar.tsx
    src/components/ftc/provisions/ProvisionsLanding.tsx
  </files>
  <action>
1. Create `src/hooks/use-provisions.ts` with two React Query hooks:

   `useProvisionsManifest()`:
   - Fetches `/data/provisions/manifest.json`
   - queryKey: `["provisions-manifest"]`
   - staleTime: Infinity (static data)
   - Returns typed `ProvisionsManifest` from `@/types/ftc`

   `useProvisionShard(shardFilename: string | null)`:
   - Fetches `/data/provisions/${shardFilename}`
   - queryKey: `["provisions", shardFilename]`
   - enabled: `!!shardFilename`
   - staleTime: Infinity
   - Returns typed `ProvisionShardFile` from `@/types/ftc`

2. Create `src/components/ftc/provisions/TopicSidebar.tsx`:
   - Receives `manifest: ProvisionsManifest`, `selectedTopic: string | null`, `onSelectTopic: (topicSlug: string) => void` as props
   - Groups topics from manifest into three sections using `category` field:
     - "Statutory Authority" (category === "statutory")
     - "Practice Area" (category === "practice_area")
     - "Remedy Type" (category === "remedy_type")
   - Each group has a heading styled like analytics sidebar sections (text-xs uppercase tracking-wide-label)
   - Each topic item shows the `label` and a `Badge` component with the `count`
   - Selected topic is highlighted with left border gold + font-semibold (similar to FTCSectionSidebar active style)
   - Desktop: sticky sidebar (w-56, sticky top-24) with scroll-area if topics overflow
   - Mobile: horizontal scrollable bar at top (similar to FTCSectionSidebar mobile pattern)
   - Sort topics alphabetically within each group

3. Create `src/components/ftc/provisions/ProvisionsLanding.tsx`:
   - Receives `manifest: ProvisionsManifest` as props
   - Displays a centered layout with:
     - Title: "Provisions Library" (text-3xl font-garamond font-semibold)
     - Subtitle with total counts: "Browse {total_provisions} provisions from {total_cases} FTC consent orders"
     - Brief prompt: "Select a topic from the sidebar to view provisions organized by statutory authority, practice area, or remedy type."
     - Disclaimer banner: "Note: Provision text is extracted from consent order PDFs using automated processing and should be verified against the original source documents available on the FTC website."
     - Styled consistently with law-library aesthetic (cream backgrounds, rule borders)
  </action>
  <verify>
- `src/hooks/use-provisions.ts` exports `useProvisionsManifest` and `useProvisionShard`
- `src/components/ftc/provisions/TopicSidebar.tsx` renders grouped topics with count badges
- `src/components/ftc/provisions/ProvisionsLanding.tsx` renders overview with total counts
- `npx tsc --noEmit` passes or shows no new errors beyond pre-existing ones
  </verify>
  <done>
- Data hooks fetch manifest and individual shards via React Query with correct typing
- Topic sidebar groups 25 topics under three category headings with count badges and selection highlight
- Landing view displays total provision/case counts and disclaimer banner
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ProvisionCard, ProvisionsContent, and wire FTCProvisionsTab</name>
  <files>
    src/components/ftc/provisions/ProvisionCard.tsx
    src/components/ftc/provisions/ProvisionsContent.tsx
    src/components/ftc/FTCProvisionsTab.tsx
  </files>
  <action>
1. Create `src/components/ftc/provisions/ProvisionCard.tsx`:
   - Receives `provision: ProvisionRecord` as prop (and optional `searchQuery?: string` for later use in Plan 04)
   - Per user decision: context header bar + verbatim text layout
   - Header bar (`bg-primary/5 border-b border-rule px-4 py-3`):
     - Company name (font-semibold text-primary font-garamond)
     - Year (text-sm text-muted-foreground)
     - Docket number (text-sm text-muted-foreground)
     - Citation: "Part {provision_number}" (text-sm font-medium text-gold-dark) — per PROV-03
     - Violation type badge (text-xs uppercase tracking-wide-label) — per PROV-04
     - "View on FTC.gov" link (ml-auto, text-sm text-gold hover:text-gold-dark, external link icon from lucide-react) — links to provision.ftc_url, target="_blank" rel="noopener noreferrer"
   - Body section (`px-4 py-4 font-garamond text-foreground leading-relaxed`):
     - Provision title as h4 (font-semibold mb-2)
     - Full verbatim text displayed — NO truncation, NO "read more" collapse (per user decision)
     - Use `whitespace-pre-line` to preserve paragraph breaks in verbatim_text
   - Card wrapper: `border border-rule bg-cream/30 mb-4`
   - If verbatim_text is empty, fall back to showing summary with a subtle "(summary)" label

2. Create `src/components/ftc/provisions/ProvisionsContent.tsx`:
   - Receives `topic: string` (slug from URL), `manifest: ProvisionsManifest` as props
   - Uses `useProvisionShard(manifest.topics[topic]?.shard)` to fetch the selected topic's data
   - Displays:
     - Topic header: topic label from manifest, provision count
     - Disclaimer banner (single banner per user decision): "Note: Provision text is extracted from consent order PDFs using automated processing and should be verified against the original source documents available on the FTC website." — styled as `border border-rule bg-cream/50 p-4 text-sm text-muted-foreground mb-6`
     - Provision count: "Showing {displayed} of {total} provisions from {uniqueCases} cases" (PROV-10 partial)
     - Paginated list of ProvisionCard components — 50 per page
     - Pagination controls at bottom using shadcn/ui Pagination component (PaginationContent, PaginationItem, PaginationPrevious, PaginationNext, PaginationLink)
   - Loading state: spinner while shard fetches
   - Error state: friendly error message
   - Default sort: by date descending (most recent first) — per Claude's discretion

3. Replace `src/components/ftc/FTCProvisionsTab.tsx`:
   - Replace the placeholder "Coming Soon" content with the actual provisions tab
   - Uses `useSearchParams` to read/write `topic` search param from URL
   - Uses `useProvisionsManifest()` to fetch manifest
   - Layout: `flex gap-6 py-6` container
     - Left: `<TopicSidebar>` with manifest, selectedTopic, and onSelectTopic handler
     - Right: `flex-1 min-w-0` content area
       - If no topic selected: `<ProvisionsLanding manifest={manifest} />`
       - If topic selected: `<ProvisionsContent topic={selectedTopic} manifest={manifest} />`
   - `handleTopicSelect` function: sets `topic` param in URL, keeps `tab=provisions` param
   - Loading/error states from manifest hook

  </action>
  <verify>
- Start dev server (`npm run dev`) and navigate to `/FTCAnalytics?tab=provisions`
- Verify the landing view shows with total counts
- Click a topic in the sidebar — verify provision cards load with verbatim text and context headers
- Verify pagination works (navigate to page 2 for a large topic like Section 5 Only)
- Verify "View on FTC.gov" links open in new tab
- Verify URL updates with `?tab=provisions&topic=coppa` pattern
  </verify>
  <done>
- Provision cards show verbatim order language as primary content with context header (PROV-02, PROV-03, PROV-04)
- Topic selection from sidebar loads and displays provisions with pagination (PROV-01)
- Provision count is displayed above the card list (PROV-10 partial)
- Landing view shows totals when no topic is selected
- URL-driven topic selection via search params
  </done>
</task>

</tasks>

<verification>
- Navigate to `/FTCAnalytics?tab=provisions` — landing view shows
- Select COPPA from sidebar — provisions load with verbatim text and context headers
- Each card has company name, year, docket number, citation ("Part I"), violation type, and "View on FTC.gov" link
- Pagination works for topics with many provisions
- URL reflects selected topic
- No console errors
</verification>

<success_criteria>
Legal practitioners can select a topic and browse provision cards showing verbatim order language with exact citations and case context. The core browsing experience is functional with pagination.
</success_criteria>

<output>
After completion, create `.planning/phases/03-provisions-library/03-02-SUMMARY.md`
</output>
