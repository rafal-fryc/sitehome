---
phase: 04-company-industry-view
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ftc/FTCTabShell.tsx
  - src/components/ftc/FTCIndustryTab.tsx
  - src/components/ftc/industry/industry-utils.ts
  - src/components/ftc/industry/SectorGrid.tsx
  - src/components/ftc/industry/SectorCard.tsx
autonomous: true
requirements: [INDY-01]

must_haves:
  truths:
    - "Industries tab appears in FTCTabShell navigation alongside Analytics, Provisions Library, and Patterns"
    - "User sees a grid of 8 sector cards with name, case count, and top enforcement topic tags"
    - "User can expand a sector card to see subsector breakdown inline"
    - "Clicking a sector card navigates to ?tab=industries&sector=slug URL"
    - "Navigating back to the grid shows all sector cards without stale state"
  artifacts:
    - path: "src/components/ftc/FTCTabShell.tsx"
      provides: "Industries tab trigger and content"
      contains: "industries"
    - path: "src/components/ftc/FTCIndustryTab.tsx"
      provides: "Top-level industry tab component with URL-driven view routing"
      exports: ["default"]
    - path: "src/components/ftc/industry/industry-utils.ts"
      provides: "Sector taxonomy, subsector keyword mapping, helper functions"
      exports: ["SECTOR_TAXONOMY", "getSectorBySlug", "classifySubsector"]
    - path: "src/components/ftc/industry/SectorGrid.tsx"
      provides: "Card grid layout for all sectors"
      exports: ["default"]
    - path: "src/components/ftc/industry/SectorCard.tsx"
      provides: "Individual sector card with collapsible subsector expansion"
      exports: ["default"]
  key_links:
    - from: "src/components/ftc/FTCTabShell.tsx"
      to: "src/components/ftc/FTCIndustryTab.tsx"
      via: "TabsContent value=industries"
      pattern: "TabsContent.*industries"
    - from: "src/components/ftc/FTCIndustryTab.tsx"
      to: "src/components/ftc/industry/SectorGrid.tsx"
      via: "default view when no sector param in URL"
      pattern: "selectedSector.*SectorGrid"
    - from: "src/components/ftc/industry/SectorGrid.tsx"
      to: "src/components/ftc/industry/industry-utils.ts"
      via: "SECTOR_TAXONOMY import for sector definitions"
      pattern: "SECTOR_TAXONOMY"
---

<objective>
Add the Industries tab to FTCTabShell, define the sector taxonomy and subsector keyword classification, and build the sector card grid landing page with expandable subsector breakdowns.

Purpose: Establishes the industry browsing entry point. Users can see all 8 sectors at a glance with case counts, top topics, and subsector composition -- the foundation for all subsequent sector detail and comparison views.

Output: Industries tab in navigation, sector grid landing page with expandable cards, sector taxonomy constants, URL-driven routing skeleton.
</objective>

<execution_context>
@C:/Users/rafst/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rafst/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-company-industry-view/04-RESEARCH.md
@src/components/ftc/FTCTabShell.tsx
@src/types/ftc.ts
@src/components/ftc/analytics/ProvisionAnalytics.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Industries tab to FTCTabShell and create FTCIndustryTab with URL-driven view routing</name>
  <files>
    src/components/ftc/FTCTabShell.tsx
    src/components/ftc/FTCIndustryTab.tsx
  </files>
  <action>
Modify FTCTabShell.tsx:
1. Add "industries" to the FTCTab union type: `type FTCTab = "analytics" | "provisions" | "patterns" | "industries";`
2. Add "industries" to VALID_TABS array
3. Add TabsTrigger: `<TabsTrigger value="industries">Industries</TabsTrigger>` — place it after "Provisions Library" and before "Patterns"
4. Add TabsContent that renders `<FTCIndustryTab data={data} />` — pass data (FTCDataPayload) as props, same as FTCAnalyticsTab
5. Import FTCIndustryTab at top of file

Create FTCIndustryTab.tsx:
1. Accept Props: `{ data: FTCDataPayload }`
2. Read URL params via useSearchParams: extract `sector` param and `compare` param
3. Cast `data.cases as EnhancedFTCCaseSummary[]`
4. Compute sectorStats using useMemo — iterate all cases, for each case iterate industry_sectors, aggregate into a Record<string, { cases: EnhancedFTCCaseSummary[], topicCounts: Record<string, number>, remedyCounts: Record<string, number> }>
5. Route between three views based on URL params:
   - No `sector` and no `compare` param → render `<SectorGrid>` (landing page)
   - `sector` param present → render `<SectorDetail>` (Plan 02 will create this; for now render a placeholder div with "Sector detail: {sector}")
   - `compare` param present → render `<SectorCompare>` (Plan 03 will create this; for now render a placeholder div with "Compare: {compare}")
6. Use `export default function FTCIndustryTab({ data }: Props)` pattern (matches project convention for newer FTC components)
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors. Run `npx vite build` — no build failures. Open the app and confirm the Industries tab appears in the tab bar. Clicking Industries shows the sector grid (or placeholder if grid not yet built). Switching to another tab and back shows the landing page without stale sector param.
  </verify>
  <done>Industries tab renders in FTCTabShell. FTCIndustryTab reads URL params and routes to grid/detail/compare views. Tab switching clears industry-specific params per existing handleTabChange behavior.</done>
</task>

<task type="auto">
  <name>Task 2: Create sector taxonomy, subsector classification, and sector card grid with expandable subsectors</name>
  <files>
    src/components/ftc/industry/industry-utils.ts
    src/components/ftc/industry/SectorGrid.tsx
    src/components/ftc/industry/SectorCard.tsx
  </files>
  <action>
Create industry-utils.ts:
1. Define SectorDefinition interface: `{ slug: string; label: string; icon?: string; subsectors: SubsectorDefinition[] }`
2. Define SubsectorDefinition: `{ label: string; keywords: string[] }` — keywords match against business_description
3. Export SECTOR_TAXONOMY array with these 8 sectors and their subsectors (from research):
   - Technology (slug: "technology"): Software & Apps ["software", "app", "mobile app", "platform"], IoT & Connected Devices ["iot", "connected", "smart", "wearable", "device"], Ad Tech & Tracking ["advertising", "ad tech", "tracking", "analytics", "data broker"], Cloud Services ["cloud", "hosting", "saas"], General Technology []
   - Financial Services (slug: "financial-services"): Banking & Lending ["bank", "lending", "loan", "mortgage"], Credit Reporting ["credit report", "credit bureau", "credit score"], Insurance ["insurance"], Payment Processing ["payment", "fintech"], General Financial []
   - Retail (slug: "retail"): E-Commerce ["e-commerce", "ecommerce", "online retail", "online store", "marketplace"], Brick-and-Mortar ["store", "retail chain", "retailer"], General Retail []
   - Healthcare (slug: "healthcare"): Health Tech & Apps ["health app", "fitness", "telehealth", "telemedicine"], Health Services ["hospital", "clinic", "medical"], Pharma & Biotech ["pharma", "biotech", "drug"], General Healthcare []
   - Social Media (slug: "social-media"): Social Networks ["social network", "social media"], Online Communities ["forum", "community", "messaging"], General Social Media []
   - Education (slug: "education"): EdTech ["edtech", "educational technology", "learning platform", "online learning"], Educational Institutions ["school", "university", "college"], General Education []
   - Telecom (slug: "telecom"): ISPs & Carriers ["isp", "internet service", "carrier", "wireless", "broadband"], General Telecom []
   - Other (slug: "other"): General []
4. Export helper functions:
   - `getSectorBySlug(slug: string): SectorDefinition | undefined`
   - `getSectorSlug(label: string): string` — converts IndustrySector type label to slug (e.g., "Financial Services" → "financial-services")
   - `getSectorLabel(slug: string): string | undefined` — reverse lookup
   - `classifySubsector(sectorSlug: string, businessDescription: string): string` — matches business_description against subsector keywords for a given sector; returns subsector label or "General [Sector]" if no match. Case-insensitive matching. Check keywords in order, return first match.
5. Export `getTopTopics(cases: EnhancedFTCCaseSummary[], limit: number): string[]` — counts statutory_topics across cases, returns top N by frequency
6. Import EnhancedFTCCaseSummary type

Create SectorGrid.tsx:
1. Accept Props: `{ sectorStats: Record<string, { cases: EnhancedFTCCaseSummary[] }>, onSelectSector: (slug: string) => void, selectedSectors: Set<string>, onToggleSelect: (slug: string) => void }`
2. Import SECTOR_TAXONOMY, getSectorSlug, getTopTopics from industry-utils
3. Map SECTOR_TAXONOMY to SectorCard components in a responsive grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
4. For each sector, compute from sectorStats: case count, top 3 topics (using getTopTopics), subsector counts (group cases by classifySubsector result)
5. Pass selectedSectors and onToggleSelect for compare checkbox functionality
6. Add a sticky bottom bar (only visible when selectedSectors.size >= 2) with: "N sectors selected" text + "Compare Selected" button (styled with bg-primary text-cream) + "Clear" button. Compare button calls onSelectSector with special compare action (or parent handles this).
7. Actually, let the parent (FTCIndustryTab) handle the compare navigation. SectorGrid just calls `onToggleSelect` for checkboxes and `onSelectSector` for card clicks.

Create SectorCard.tsx:
1. Accept Props: `{ sector: SectorDefinition, caseCount: number, topTopics: string[], subsectorCounts: { label: string; count: number }[], isSelected: boolean, onSelect: () => void, onToggleSelect: () => void }`
2. Use Card, CardHeader, CardContent from shadcn/ui
3. Use Collapsible, CollapsibleTrigger, CollapsibleContent from shadcn/ui for subsector expansion
4. Use Badge component for topic tags and case count
5. Use ChevronDown/ChevronRight from lucide-react for expand icon
6. Card onClick navigates to sector detail (onSelect). Add a checkbox in top-right corner for compare selection (onToggleSelect) — use a Checkbox from shadcn/ui with stopPropagation to prevent card click.
7. Card styling: `cursor-pointer hover:border-gold/50 transition-colors` with `border-gold bg-gold/5` when isSelected
8. Sector label: `text-lg font-semibold font-garamond text-primary`
9. Topic badges: `variant="outline" className="text-xs font-garamond"`
10. Subsector expansion: CollapsibleTrigger shows "N subsectors" with chevron icon. CollapsibleContent shows a list of subsector label + count pairs.
11. Local state for isExpanded using useState

Note: business_description is NOT currently in ftc-cases.json (per research). For subsector classification, we need it. The research recommended adding it to the build pipeline (Option 1). However, since the subsector display is a UI enhancement and we want to avoid pipeline changes in this phase, use a simpler approach: derive subsectors from the existing case data fields. The classifySubsector function should accept the company_name and categories fields as fallback if business_description is unavailable. For now, since business_description is not in the data, subsectors will show "General [Sector]" for most cases — this is acceptable per research ("Accept that some cases will fall into a General subsector"). The subsector expansion will still work, it will just show most cases under "General". Future enhancement can add business_description to the pipeline.

UPDATE: Actually, check if the source ftc-files have business_description accessible at runtime. They do NOT — those are build-time files, not served to the browser. So subsector classification must work with what's in ftc-cases.json: company_name, categories, legal_authority, statutory_topics, practice_areas, etc. Use categories and company_name for keyword matching instead of business_description. Update classifySubsector to accept these fields.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors. Run `npx vite build` — no build failures. Open app, navigate to Industries tab, confirm 8 sector cards appear in a grid with case counts and topic tag badges. Click expand on a sector card to confirm subsector breakdown shows. Click a sector card to confirm URL changes to `?tab=industries&sector=technology` (or appropriate slug). Verify that navigating back shows the grid.
  </verify>
  <done>8 sector cards display in a responsive grid. Each card shows sector name, case count, top 3 enforcement topics as badges, and an expandable subsector breakdown. Checkbox selection works for future compare functionality. Card click navigates to sector detail URL.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vite build` succeeds
3. Industries tab visible in FTCTabShell tab bar
4. Sector grid shows 8 cards matching the IndustrySector type values
5. Case counts across sectors sum to more than 285 (because cases appear in multiple sectors)
6. Top topic badges are visible on each card
7. Subsector expansion works via Collapsible
8. Card click updates URL to ?tab=industries&sector={slug}
9. Tab switching clears industry params (existing handleTabChange behavior)
</verification>

<success_criteria>
Industries tab is accessible in the navigation. The landing page shows a responsive grid of 8 sector cards with case counts, topic tags, and expandable subsectors. Sector card clicks navigate to the sector detail URL. The sector taxonomy is centralized in industry-utils.ts for reuse by detail and compare views.
</success_criteria>

<output>
After completion, create `.planning/phases/04-company-industry-view/04-01-SUMMARY.md`
</output>
