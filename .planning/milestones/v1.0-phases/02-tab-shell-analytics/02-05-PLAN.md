---
phase: 02-tab-shell-analytics
plan: 05
type: execute
wave: 4
depends_on: [02-01, 02-02, 02-03, 02-04]
files_modified:
  - src/components/ftc/FTCAnalyticsTab.tsx
autonomous: false
requirements: [ANLY-01, ANLY-02, ANLY-03, ANLY-04, ANLY-05, ANLY-06, ANLY-07, ANLY-08, NAVX-01, NAVX-02, NAVX-03, NAVX-04, NAVX-05]

must_haves:
  truths:
    - "Analytics tab shows sidebar + all chart sections in the correct vertical order"
    - "Sidebar highlights the active section as the user scrolls"
    - "All chart+table sections render with real data from ftc-cases.json"
    - "Expandable table rows work in all reference tables"
    - "Page performs smoothly — no visible lag on initial load or scroll"
    - "The overall composition matches the law-library aesthetic"
  artifacts:
    - path: "src/components/ftc/FTCAnalyticsTab.tsx"
      provides: "Complete analytics tab with sidebar, summary, all chart sections"
  key_links:
    - from: "src/components/ftc/FTCAnalyticsTab.tsx"
      to: "src/components/ftc/FTCSectionSidebar.tsx"
      via: "sidebar composition with flex layout"
      pattern: "import FTCSectionSidebar"
    - from: "src/components/ftc/FTCAnalyticsTab.tsx"
      to: "src/components/ftc/analytics/EnforcementByYear.tsx"
      via: "section rendering"
      pattern: "import EnforcementByYear"
    - from: "src/components/ftc/FTCAnalyticsTab.tsx"
      to: "src/components/ftc/analytics/TopicTrendLines.tsx"
      via: "section rendering"
      pattern: "import TopicTrendLines"
---

<objective>
Integrate all analytics sections into the FTCAnalyticsTab with sidebar navigation, producing the complete analytics dashboard experience.

Purpose: This is the final assembly plan — composing the sidebar, summary, and all chart+table sections into the Analytics tab layout. It replaces the existing grouping-based views with the new richer analytics sections and includes a visual checkpoint for user approval.

Output: Updated FTCAnalyticsTab.tsx with full sidebar + chart section layout.
</objective>

<execution_context>
@C:/Users/rafst/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rafst/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-tab-shell-analytics/02-CONTEXT.md
@.planning/phases/02-tab-shell-analytics/02-RESEARCH.md
@.planning/phases/02-tab-shell-analytics/02-01-SUMMARY.md
@.planning/phases/02-tab-shell-analytics/02-02-SUMMARY.md
@.planning/phases/02-tab-shell-analytics/02-03-SUMMARY.md
@.planning/phases/02-tab-shell-analytics/02-04-SUMMARY.md
@src/components/ftc/FTCAnalyticsTab.tsx
@src/components/ftc/FTCSectionSidebar.tsx
@src/components/ftc/analytics/AnalyticsSummary.tsx
@src/components/ftc/analytics/EnforcementByYear.tsx
@src/components/ftc/analytics/EnforcementByAdmin.tsx
@src/components/ftc/analytics/TopicTrendLines.tsx
@src/components/ftc/analytics/ProvisionAnalytics.tsx
@src/components/ftc/analytics/ViolationBreakdown.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compose full analytics layout with sidebar and all sections</name>
  <files>
    src/components/ftc/FTCAnalyticsTab.tsx
  </files>
  <action>
    Rewrite FTCAnalyticsTab.tsx to compose all analytics sections with the sidebar.

    Import all new components:
    - FTCSectionSidebar from @/components/ftc/FTCSectionSidebar
    - AnalyticsSummary from @/components/ftc/analytics/AnalyticsSummary
    - EnforcementByYear from @/components/ftc/analytics/EnforcementByYear
    - EnforcementByAdmin from @/components/ftc/analytics/EnforcementByAdmin
    - TopicTrendLines from @/components/ftc/analytics/TopicTrendLines
    - ViolationBreakdown from @/components/ftc/analytics/ViolationBreakdown
    - ProvisionAnalytics from @/components/ftc/analytics/ProvisionAnalytics
    - FTCMissingCasesNotice (existing)

    Define sections array for sidebar:
    ```typescript
    const ANALYTICS_SECTIONS = [
      { id: "enforcement-by-year", label: "By Year" },
      { id: "enforcement-by-admin", label: "By Administration" },
      { id: "topic-trends", label: "Topic Trends" },
      { id: "violation-breakdown", label: "Violations" },
      { id: "provision-analytics", label: "Provisions" },
    ];
    ```

    Layout structure (per CONTEXT.md decisions):
    - FTCMissingCasesNotice at top
    - AnalyticsSummary (headline + summary sentence)
    - Flex container: FTCSectionSidebar (left, sticky) + main content area (right, flex-1)
    - On desktop (lg+): `flex gap-8` with sidebar visible
    - On mobile: sidebar renders as horizontal bar above content (handled by FTCSectionSidebar internally)
    - Main content area: `flex-1 min-w-0 space-y-12`
    - Sections stack vertically with space-y-12 between sections

    Section order (per CONTEXT.md):
    1. EnforcementByYear (enforcement trends by year)
    2. EnforcementByAdmin (enforcement by presidential administration)
    3. TopicTrendLines (topic-over-time trend lines)
    4. ViolationBreakdown (violation type breakdown)
    5. ProvisionAnalytics (provision-level analytics)

    Each section component already has its own section wrapper div with the correct id attribute.

    REMOVE the old grouping-based views (FTCGroupingSelector, FTCGroupChart, FTCGroupList, FTCGroupDetail, FTCOverviewStats, ViolationDonut) — these are replaced by the new dedicated sections. Also remove the groupingMode/selectedGroup state and handleModeChange/handleGroupSelect handlers. Clean up the old URL params (mode, group) — they are no longer needed.

    Keep the container styling: `container max-w-6xl mx-auto px-4 py-8`

    Ensure the component still receives { data: FTCDataPayload } as props and passes data to each section component.
  </action>
  <verify>
    Run `npx tsc --noEmit` — zero TypeScript errors.
    Run `npx vite build` — build succeeds.
    Navigate to /FTCAnalytics — analytics tab shows all 5 sections with sidebar.
    Scroll through sections — sidebar highlights update correctly.
    Click sidebar links — smooth scroll to target sections.
    On mobile viewport: sidebar collapses to horizontal bar.
    All charts render with real data. All reference tables are expandable.
  </verify>
  <done>
    FTCAnalyticsTab.tsx composes all analytics sections with sidebar navigation. Old grouping views are replaced by richer dedicated chart+table sections. Layout uses flex with sticky sidebar on desktop and horizontal bar on mobile.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of complete analytics dashboard</name>
  <files>src/components/ftc/FTCAnalyticsTab.tsx</files>
  <action>
    Human visual verification of the complete Phase 2 analytics dashboard.

    What was built:
    - Three-tab shell (Analytics, Provisions Library, Patterns) with URL-driven state
    - Analytics tab with sticky sidebar navigation
    - Five chart+table sections: Enforcement by Year, Enforcement by Administration, Topic Trend Lines, Violation Breakdown, Provision Analytics
    - Expandable reference table rows in all sections
    - Law-library aesthetic throughout

    Verification steps:
    1. Open http://localhost:5173/FTCAnalytics (or your dev server URL)
    2. Verify three tabs visible below the header: Analytics, Provisions Library, Patterns
    3. Verify Analytics tab is active by default with cream/gold filled background
    4. Verify the analytics summary headline shows correct date range and case count
    5. Scroll down through all 5 chart sections — verify sidebar highlights update
    6. Click sidebar section links — verify smooth scroll to target section
    7. In "Enforcement by Year": verify stacked bar chart renders, click a table row to expand
    8. In "Enforcement by Administration": verify chart renders, verify table comparison
    9. In "Topic Trends": verify multi-line chart shows topic lines, verify reference table
    10. Click "Provisions Library" tab — verify placeholder, URL updates to ?tab=provisions
    11. Click "Patterns" tab — verify placeholder, URL updates to ?tab=patterns
    12. Click back to "Analytics" — verify all content reappears
    13. Resize browser to mobile width — verify sidebar collapses to horizontal bar
    14. Verify overall law-library aesthetic: EB Garamond, cream/gold/dark-green, sharp corners

    Resume signal: Type "approved" to complete Phase 2, or describe any issues to fix.
  </action>
  <verify>User confirms visual verification by typing "approved" or provides feedback on issues.</verify>
  <done>Human has approved the complete analytics dashboard. All Phase 2 visual and functional requirements verified by user inspection.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vite build` succeeds
3. All 5 analytics sections render with real data
4. Sidebar navigation works (scroll tracking + click-to-jump)
5. Tab switching works with URL state
6. Expandable table rows work in all reference tables
7. Mobile responsive layout works
8. Law-library aesthetic is consistent throughout
9. No visible performance lag with 293 cases
10. Human verification checkpoint approved
</verification>

<success_criteria>
- Complete analytics dashboard renders with 5 chart+table sections
- Sidebar navigation enables quick jumping between sections
- All Phase 2 requirements (ANLY-01 through ANLY-08, NAVX-01 through NAVX-05) satisfied
- User approves visual verification
</success_criteria>

<output>
After completion, create `.planning/phases/02-tab-shell-analytics/02-05-SUMMARY.md`
</output>
