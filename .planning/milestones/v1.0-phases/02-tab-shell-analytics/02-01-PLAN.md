---
phase: 02-tab-shell-analytics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/FTCAnalytics.tsx
  - src/components/ftc/FTCTabShell.tsx
  - src/components/ftc/FTCAnalyticsTab.tsx
  - src/components/ftc/FTCProvisionsTab.tsx
  - src/components/ftc/FTCPatternsTab.tsx
  - src/components/ui/tabs.tsx
autonomous: true
requirements: [NAVX-01, NAVX-02, NAVX-03, NAVX-04, NAVX-05, ANLY-07]

must_haves:
  truths:
    - "Three tabs (Analytics, Provisions Library, Patterns) are visible below the page header"
    - "Clicking a tab switches content without full page reload"
    - "Active tab has a cream/gold filled background; inactive tabs are transparent"
    - "URL updates with ?tab= param when switching tabs (analytics is default, no param needed)"
    - "All existing FTC analytics content (stats, donut, grouping selector, chart, list, detail) appears inside the Analytics tab exactly as before"
    - "Provisions Library and Patterns tabs show placeholder content"
    - "Page renders without visible lag with 293 cases"
  artifacts:
    - path: "src/components/ftc/FTCTabShell.tsx"
      provides: "Tab bar with three panels and URL-driven state"
      exports: ["default"]
    - path: "src/components/ftc/FTCAnalyticsTab.tsx"
      provides: "All existing analytics content moved from FTCAnalytics.tsx"
      exports: ["default"]
    - path: "src/components/ftc/FTCProvisionsTab.tsx"
      provides: "Placeholder for Phase 3"
      exports: ["default"]
    - path: "src/components/ftc/FTCPatternsTab.tsx"
      provides: "Placeholder for Phase 5"
      exports: ["default"]
    - path: "src/pages/FTCAnalytics.tsx"
      provides: "Thin wrapper: FTCHeader + FTCTabShell"
  key_links:
    - from: "src/pages/FTCAnalytics.tsx"
      to: "src/components/ftc/FTCTabShell.tsx"
      via: "default import and render"
      pattern: "import FTCTabShell"
    - from: "src/components/ftc/FTCTabShell.tsx"
      to: "useSearchParams"
      via: "URL-driven tab state"
      pattern: "useSearchParams.*tab"
    - from: "src/components/ftc/FTCTabShell.tsx"
      to: "src/components/ftc/FTCAnalyticsTab.tsx"
      via: "TabsContent render"
      pattern: "TabsContent.*analytics"
---

<objective>
Create a three-tab navigation shell for the FTC enforcement page and restructure the existing page so all current analytics content lives inside the Analytics tab.

Purpose: Establish the foundational page architecture that all Phase 2 analytics sections and Phase 3/5 features will be built into. Without this shell, no other Phase 2 work can begin.

Output: FTCTabShell.tsx with URL-driven tabs, FTCAnalyticsTab.tsx with all existing analytics content, placeholder tabs for Provisions Library and Patterns.
</objective>

<execution_context>
@C:/Users/rafst/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rafst/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-tab-shell-analytics/02-CONTEXT.md
@.planning/phases/02-tab-shell-analytics/02-RESEARCH.md
@src/pages/FTCAnalytics.tsx
@src/components/ftc/FTCHeader.tsx
@src/components/ftc/FTCGroupChart.tsx
@src/components/ftc/FTCOverviewStats.tsx
@src/components/ui/tabs.tsx
@src/types/ftc.ts
@src/hooks/use-ftc-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FTCTabShell, placeholder tabs, and update tabs.tsx styling</name>
  <files>
    src/components/ftc/FTCTabShell.tsx
    src/components/ftc/FTCProvisionsTab.tsx
    src/components/ftc/FTCPatternsTab.tsx
    src/components/ui/tabs.tsx
  </files>
  <action>
    Create FTCTabShell.tsx:
    - Import Tabs, TabsList, TabsTrigger, TabsContent from @/components/ui/tabs
    - Import useSearchParams from react-router-dom
    - Import FTCAnalyticsTab (will exist after Task 2), FTCProvisionsTab, FTCPatternsTab
    - Define type FTCTab = "analytics" | "provisions" | "patterns"
    - Read `tab` from searchParams, validate against VALID_TABS array, default to "analytics"
    - handleTabChange: when switching tabs, clear ALL tab-specific params (mode, group) by creating fresh URLSearchParams. Only set `tab` param if value is NOT "analytics" (keep default URL clean). Use setSearchParams with { replace: true }.
    - Render Tabs with value={activeTab} onValueChange={handleTabChange}
    - TabsList should be full-width: className="w-full justify-start" (horizontal bar below header)
    - Three TabsTriggers: "Analytics", "Provisions Library", "Patterns"
    - Three TabsContent panels rendering the respective tab components
    - Pass useFTCData() result to FTCAnalyticsTab as props (data, isLoading, error) so the data hook is called once at the shell level. This avoids duplicate fetches.

    Update src/components/ui/tabs.tsx:
    - Add active tab cream/gold filled background per user decision. On the TabsTrigger className, add: `data-[state=active]:bg-gold/15` alongside the existing `data-[state=active]:text-primary data-[state=active]:border-b-gold`. This gives active tabs a subtle cream/gold fill.

    Create FTCProvisionsTab.tsx:
    - Simple placeholder component: "Provisions Library — Coming Soon" centered text
    - Use law-library aesthetic: EB Garamond font, muted-foreground color
    - Include brief description: "Browse FTC consent order provisions by statutory topic, practice area, and remedy type."
    - Include NAVX-05 OCR caveat: Add a note mentioning that provision text is extracted from consent order PDFs and should be verified against source documents.

    Create FTCPatternsTab.tsx:
    - Simple placeholder component: "Cross-Case Patterns — Coming Soon" centered text
    - Use law-library aesthetic
    - Brief description: "Discover recurring provision language patterns across FTC enforcement actions."
  </action>
  <verify>
    Run `npx tsc --noEmit` — zero TypeScript errors.
    Visually confirm: FTCTabShell imports compile, placeholder components export default functions.
  </verify>
  <done>
    FTCTabShell.tsx exists with URL-driven tab switching. TabsTrigger has cream/gold active background. Two placeholder tab components exist with law-library styling and descriptive text.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract FTCAnalyticsTab from FTCAnalytics.tsx and rewire page</name>
  <files>
    src/components/ftc/FTCAnalyticsTab.tsx
    src/pages/FTCAnalytics.tsx
  </files>
  <action>
    Create FTCAnalyticsTab.tsx:
    - Move ALL content from FTCAnalytics.tsx's return statement (everything inside the `<main>` tag) into this new component
    - Props interface receives { data: FTCDataPayload } (loading/error handled at shell level)
    - Move the grouping state (groupingMode, selectedGroup, handleModeChange, handleGroupSelect) into this component since it is analytics-specific state. These handlers should use setSearchParams but must MERGE with the existing tab param — read current searchParams, preserve the `tab` param if present, update mode/group params.
    - Import all existing FTC child components: FTCMissingCasesNotice, FTCOverviewStats, ViolationDonut, FTCGroupingSelector, FTCGroupChart, FTCGroupList, FTCGroupDetail
    - Preserve the exact same JSX structure and Tailwind classes for all existing content
    - This component does NOT call useFTCData() — it receives data via props

    Rewrite FTCAnalytics.tsx as a thin wrapper:
    - Import FTCHeader and FTCTabShell
    - Render: div.min-h-screen.bg-background > FTCHeader > FTCTabShell
    - Remove ALL existing state, handlers, child component imports, and the loading/error UI from FTCAnalytics.tsx — those are now in FTCTabShell (loading/error) and FTCAnalyticsTab (state/handlers)
    - FTCTabShell handles useFTCData(), loading spinner, and error state internally before rendering tab content

    CRITICAL: The existing URL params (?mode=year&group=2024) must continue to work within the Analytics tab. When the analytics tab is active, mode and group params should be readable. When switching away from analytics, mode and group are cleared (handled by FTCTabShell's handleTabChange).
  </action>
  <verify>
    Run `npx tsc --noEmit` — zero TypeScript errors.
    Run `npx vite build` — build succeeds with no errors.
    Navigate to /FTCAnalytics — page loads with three tabs, Analytics tab shows all existing content.
    Click year bars, switch grouping modes — existing interactivity preserved.
    Switch to Provisions Library tab — placeholder shows, URL updates to ?tab=provisions.
    Switch back to Analytics — content reappears, mode/group params work.
    Direct URL /FTCAnalytics?tab=patterns — Patterns placeholder loads.
    Direct URL /FTCAnalytics?mode=administration — Analytics tab active with administration view.
  </verify>
  <done>
    FTCAnalytics.tsx is a thin wrapper (FTCHeader + FTCTabShell). All existing analytics content renders identically inside the Analytics tab. Tab switching updates URL without page reload. Existing URL params (?mode, ?group) work within the Analytics tab. Active tab has cream/gold filled background.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vite build` succeeds
3. All three tabs render and switch without page reload
4. Active tab has cream/gold filled background
5. Existing analytics content (stats, donut, grouping, chart, list, detail) is fully preserved
6. URL state works: ?tab=provisions, ?mode=year&group=2024, default (no params) loads analytics
7. Law-library aesthetic (EB Garamond, cream/gold/dark-green) is consistent on tab bar and placeholders
</verification>

<success_criteria>
- Three-tab shell with URL-driven state established
- Existing functionality 100% preserved in Analytics tab
- Foundation ready for Plans 02-04 to add analytics sections
- Page loads and renders without visible lag
</success_criteria>

<output>
After completion, create `.planning/phases/02-tab-shell-analytics/02-01-SUMMARY.md`
</output>
